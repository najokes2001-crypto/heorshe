<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Он или Она - Игра на свадьбу</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Firebase App (обязательный) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            padding: 20px;
            font-size: 18px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .main {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            color: #e91e63;
            margin-bottom: 20px;
            font-size: 42px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #555;
            margin: 20px 0;
            font-size: 28px;
        }
        
        h3 {
            font-size: 22px;
            color: #777;
            margin: 15px 0;
        }
        
        .form-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
            border-left: 5px solid #e91e63;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 20px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            transition: all 0.3s;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #e91e63;
            outline: none;
            box-shadow: 0 0 10px rgba(233,30,99,0.3);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .my_button {
            background: linear-gradient(45deg, #e91e63, #ff4081);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 20px 0;
            border-radius: 20px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: inline-block;
        }
        
        .my_button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(233,30,99,0.4);
        }
        
        .my_button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .secondary_button {
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: inline-block;
        }
        
        .secondary_button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(33,150,243,0.4);
        }
        
        .question-container {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
            background: #fff9c4;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #ffeb3b;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .question-text {
            font-size: 24px;
            font-style: italic;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .answer-section {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .answer-form {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .answer-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .answer-option {
            padding: 15px 25px;
            border: 2px solid #2196f3;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .answer-option:hover {
            background: #bbdefb;
        }
        
        .answer-option.selected {
            background: #2196f3;
            color: white;
        }
        
        .results-container {
            display: none;
            margin-top: 30px;
            background: #e8f5e9;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .result-item {
            margin: 15px 0;
            font-size: 20px;
        }
        
        .highlight {
            font-weight: bold;
            color: #e91e63;
        }
        
        .guest-info {
            font-style: italic;
            color: #777;
            margin-top: 10px;
        }
        
        .anonymous {
            color: #999;
        }
        
        .spinner {
            width: 70px;
            height: 70px;
            border: 7px solid #f3f3f3;
            border-top: 7px solid #e91e63;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 30px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #f00;
            opacity: 0.8;
            border-radius: 0;
            animation: confettiFall 5s linear forwards;
            z-index: 100;
        }
        
        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
           100% { transform: translateY(1000px) rotate(720deg); opacity: 0; }
        }
        
        .error-message {
            color: #f44336;
            font-size: 18px;
            margin-top: 10px;
            display: none;
        }
        
        .success-message {
            color: #4caf50;
            font-size: 18px;
            margin-top: 10px;
            display: none;
        }
        
        .instructions {
            background: #ffecb3;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .instructions ul {
            margin-left: 20px;
        }
        
        .queue-info {
            background: #e1f5fe;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-size: 20px;
        }
        
        .queue-number {
            font-weight: bold;
            color: #e91e63;
            font-size: 24px;
        }
        
        .no-questions {
            text-align: center;
            padding: 20px;
            color: #777;
            font-style: italic;
        }
        
        .status-message {
            margin: 15px 0;
            padding: 10px;
            border-radius: 10px;
            font-size: 18px;
        }
        
        .status-waiting {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .sync-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            display: none;
            z-index: 1000;
        }
        
        .connection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            z-index: 1000;
        }
        
        .connected {
            background: #4caf50;
            color: white;
        }
        
        .disconnected {
            background: #f44336;
            color: white;
        }
        
        .offline-message {
            background: #ff9800;
            color: white;
            padding: 10px;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 2000;
            display: none;
        }
        
        .guest-photo {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid #e91e63;
            margin: 15px auto;
            display: block;
        }
        
        .question-presentation {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
            background: #fff9c4;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #ffeb3b;
        }
        
        .presentation-controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }
            
            h2 {
                font-size: 24px;
            }
            
            .my_button {
                font-size: 20px;
                padding: 12px 25px;
            }
            
            .answer-section {
                flex-direction: column;
                align-items: center;
            }
            
            .connection-status {
                top: 50px;
            }
            
            .guest-photo {
                width: 120px;
                height: 120px;
            }
        }
        
        @media (max-width: 480px) {
            .main {
                padding: 20px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .form-container {
                padding: 15px;
            }
            
            label, input, select, textarea {
                font-size: 16px;
            }
            
            .answer-options {
                flex-direction: column;
                gap: 10px;
            }
            
            .guest-photo {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="sync-indicator" id="sync-indicator">🔄 Синхронизация...</div>
    <div class="connection-status connected" id="connection-status">✓ Подключено</div>
    <div class="offline-message" id="offline-message">
        <i class="fas fa-wifi"></i> Отсутствует подключение к интернету. Проверьте соединение.
    </div>
    
    <div class="container">
        <div class='main' id="main-screen">
            <h1>🎎 Он или Она? 🎎</h1>
            <h2>Веселая игра для вашей свадьбы</h2>
            
            <div class="instructions">
                <h3>Как играть:</h3>
                <ul>
                    <li>Гости придумывают вопросы, на которые можно ответить "ОН" или "ОНА"</li>
                    <li>Все вопросы накапливаются в общем списке на всех устройствах</li>
                    <li>Когда все вопросы заданы, жених и невеста начинают отвечать</li>
                    <li>Пример вопроса: "Кто чаще моет посуду?"</li>
                </ul>
            </div>
            
            <div class="form-container">
                <div class="form-group">
                    <label for="guest-select">Кто задает вопрос?</label>
                    <select id="guest-select">
                        <option value="">-- Выберите гостя --</option>
                        <!-- Гости будут добавлены через JavaScript -->
                    </select>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="anonymous">
                    <label for="anonymous">Хочу остаться анонимным</label>
                </div>
                
                <div class="form-group">
                    <label for="question-text">Ваш вопрос (должен предполагать ответ "ОН" или "ОНА"):</label>
                    <textarea id="question-text" placeholder="Например: Кто чаще моет посуду?"></textarea>
                </div>
            </div>
            
            <button class="my_button" id="submit-question">Отправить вопрос</button>
            
            <div class="spinner" id="spinner"></div>
            <div class="error-message" id="error-message"></div>
            <div class="success-message" id="success-message"></div>
            
            <div class="queue-info">
                Вопросов собрано: <span class="queue-number" id="questions-count">0</span>
            </div>
            
            <div class="status-message status-waiting" id="status-message">
                Ожидаем вопросы от гостей...
            </div>
            
            <button class="secondary_button" id="start-presentation" disabled>Начать показ вопросов</button>
            <button class="secondary_button" id="clear-questions">🗑️ Очистить все вопросы</button>
        </div>
        
        <div class="main question-presentation" id="question-presentation">
            <h2>Вопрос для жениха и невесты:</h2>
            
            <img class="guest-photo" id="guest-photo" src="" alt="Фото гостя">
            
            <div class="question-text" id="presentation-question">
                Здесь будет отображаться вопрос от гостя
            </div>
            
            <div class="guest-info" id="presentation-author">
                Вопрос от: Гость
            </div>
            
            <div class="presentation-controls">
                <button class="my_button" id="next-presentation">Следующий вопрос</button>
                <button class="secondary_button" id="end-presentation">Завершить показ</button>
            </div>
        </div>
        
        <div class="main question-container" id="question-container">
            <h2>Вопрос для жениха и невесты:</h2>
            <div class="question-text" id="current-question">
                Здесь будет отображаться вопрос от гостя
            </div>
            <div class="guest-info" id="question-author">
                Вопрос от: Гость
            </div>
            
            <div class="answer-section" id="answer-section">
                <div class="answer-form">
                    <h3>Ответ жениха</h3>
                    <div class="answer-options">
                        <div class="answer-option" data-answer="he">ОН</div>
                        <div class="answer-option" data-answer="she">ОНА</div>
                    </div>
                    <button class="secondary_button" id="submit-groom">Подтвердить ответ</button>
                </div>
                
                <div class="answer-form">
                    <h3>Ответ невесты</h3>
                    <div class="answer-options">
                        <div class="answer-option" data-answer="he">ОН</div>
                        <div class="answer-option" data-answer="she">ОНА</div>
                    </div>
                    <button class="secondary_button" id="submit-bride">Подтвердить ответ</button>
                </div>
            </div>
        </div>
        
        <div class="main results-container" id="results-container">
            <h2>Результаты:</h2>
            <div class="question-text" id="result-question">
                Вопрос будет здесь
            </div>
            <div class="guest-info" id="result-author">
                Вопрос от: Гость
            </div>
            
            <div class="result-item">
                Ответ жениха: <span class="highlight" id="groom-answer">ОН</span>
            </div>
            
            <div class="result-item">
                Ответ невесты: <span class="highlight" id="bride-answer">ОНА</span>
            </div>
            
            <div class="result-item">
                Результат: <span class="highlight" id="result-text">Совпадение!</span>
            </div>
            
            <button class="my_button" id="next-question">Следующий вопрос</button>
            <button class="secondary_button" id="finish-answers">Завершить ответы</button>
        </div>
    </div>
    
    <script>
        // Данные о гостях
        const guestNames = [
            "Анастасия", "Дмитрий", "Наталья", "Григорий", "Виктор",
            "Алексей", "Ольга", "Наталья", "Ольга", "Роман",
            "Лилия", "Даниил", "Илья", "Наталья", "Даниил",
            "Антонина", "Дмитрий", "Алена", "Илья", "Дмитрий",
            "Мария", "Анастасия", "Влад", "Любовь", "Любовь",
            "Роман", "Светлана", "Анастасия", "Анастасия", "Анна",
            "Ярослав", "Иван", "Илья", "Любовь", "Марина", "Эдгар"
        ];

        const guestStatuses = [
            "Невеста 👰", "Жених 🤵", "Мама невесты 👩", "Папа невесты 👨", "Брат невесты 👦",
            "Папа жениха 👨", "Мачеха жениха 👩", "Бабушка жениха 👵", "Бабушка невесты 👵", "Брат жениха 👦",
            "Сестра жениха 👧", "Брат невесты 👦", "Дядя невесты 👨", "Крестная/тетя невесты 👩", "Друг жениха 🎮",
            "Вторая половинка друга жениха 💑", "Друг жениха 🎮", "Подруга жениха 💃", "Друг жениха 🎮", "Друг жениха 🎮",
            "Подруга жениха 💃", "Подруга невесты 💃", "Друг жениха 🎮", "Подруга невесты 💃", "Подруга невесты 💃",
            "Друг невесты 🎮", "Подруга невесты 💃", "Подруга невесты 💃", "Подруга невесты 💃", "Подруга невесты 💃",
            "Друг невесты 🎮", "Друг жениха 🎮", "Друг невесты 🎮", "Сводная сестра 👧", "Тетя невесты 👩", "Брат невесты 👦"
        ];
        
        // Массив для хранения вопросов
        let questions = [];
        let currentQuestionIndex = -1;
        let currentPresentationIndex = -1;
        
        // Текущий вопрос и ответы
        let currentQuestion = null;
        let groomAnswer = null;
        let brideAnswer = null;
        
        // Инициализация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCTguMinuSwBPrV8-xzkvUM9YaO3lLeFeU",
            authDomain: "wedding2025nastyushaproject.firebaseapp.com",
            databaseURL: "https://wedding2025nastyushaproject-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "wedding2025nastyushaproject",
            storageBucket: "wedding2025nastyushaproject.firebasestorage.app",
            messagingSenderId: "868560255743",
            appId: "1:868560255743:web:2c7f6c723ba0fb915a6aca"
        };
        
        // Инициализируем Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Заполняем выпадающий список гостей
        $(document).ready(function() {
            const guestSelect = $("#guest-select");
            
            for (let i = 0; i < guestNames.length; i++) {
                if (guestStatuses[i] === "Жених 🤵" || guestStatuses[i] === "Невеста 👰") {
                    continue;
                }
                
                guestSelect.append('<option value="' + i + '">' + guestNames[i] + ' - ' + guestStatuses[i] + '</option>');
            }
            
            // Проверяем онлайн-статус
            checkOnlineStatus();
            window.addEventListener('online', checkOnlineStatus);
            window.addEventListener('offline', checkOnlineStatus);
            
            // Загружаем вопросы при загрузке страницы
            loadQuestions();
            
            // Слушаем изменения в базе данных в реальном времени
            setupRealtimeListener();
            
            // Тестируем подключение к Firebase
            testFirebaseConnection();
        });
        
        // Тестирование подключения к Firebase
        function testFirebaseConnection() {
            const testRef = database.ref('connection_test');
            testRef.set({
                timestamp: Date.now(),
                message: "Testing connection"
            })
            .then(() => {
                console.log("Firebase connection test: SUCCESS");
                showSuccess("Подключение к Firebase успешно!");
            })
            .catch((error) => {
                console.error("Firebase connection test: FAILED", error);
                showError("Ошибка подключения к Firebase. Проверьте настройки доступа.");
            });
        }
        
        // Проверка онлайн-статуса
        function checkOnlineStatus() {
            if (navigator.onLine) {
                $("#offline-message").hide();
                $("#connection-status").removeClass("disconnected").addClass("connected").text("✓ Подключено");
            } else {
                $("#offline-message").show();
                $("#connection-status").removeClass("connected").addClass("disconnected").text("✗ Offline");
                showError("Отсутствует подключение к интернету. Проверьте соединение.");
            }
        }
        
        // Настраиваем прослушивание изменений в реальном времени
        function setupRealtimeListener() {
            const questionsRef = database.ref('questions');
            
            questionsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Преобразуем объект в массив
                    questions = Object.values(data);
                    updateQuestionsCount();
                    showSuccess("Список вопросов обновлен!");
                } else {
                    questions = [];
                    updateQuestionsCount();
                }
            }, (error) => {
                console.error('Ошибка при загрузке вопросов:', error);
                showError("Ошибка загрузки вопросов. Проверьте правила доступа Firebase.");
            });
        }
        
        // Функция для загрузки вопросов
        function loadQuestions() {
            if (!navigator.onLine) {
                showError("Нет подключения к интернету. Вопросы не могут быть загружены.");
                return;
            }
            
            $("#sync-indicator").show();
            
            const questionsRef = database.ref('questions');
            questionsRef.once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        questions = Object.values(data);
                    } else {
                        questions = [];
                    }
                    updateQuestionsCount();
                    $("#sync-indicator").hide();
                })
                .catch((error) => {
                    console.error('Ошибка при загрузке вопросов:', error);
                    showError("Ошибка загрузки вопросов. Попробуйте обновить страницу.");
                    $("#sync-indicator").hide();
                });
        }
        
        // Функция для сохранения вопроса
        function saveQuestion(question) {
            if (!navigator.onLine) {
                showError("Нет подключения к интернету. Вопрос не может быть отправлен.");
                return Promise.resolve(false);
            }
            
            $("#sync-indicator").show();
            
            const questionsRef = database.ref('questions');
            const newQuestionRef = questionsRef.push();
            
            return newQuestionRef.set(question)
                .then(() => {
                    $("#sync-indicator").hide();
                    return true;
                })
                .catch((error) => {
                    console.error('Ошибка при сохранении вопроса:', error);
                    $("#sync-indicator").hide();
                    showError("Ошибка при отправке вопроса. Проверьте правила доступа Firebase.");
                    return false;
                });
        }
        
        // Обработчик кнопки "Очистить все вопросы"
        $("#clear-questions").click(function() {
            if (confirm("Вы уверены, что хотите удалить все вопросы? Это действие нельзя отменить.")) {
                clearAllQuestions();
            }
        });
        
        // Функция для очистки всех вопросов
        function clearAllQuestions() {
            if (!navigator.onLine) {
                showError("Нет подключения к интернету. Вопросы не могут быть удалены.");
                return;
            }
            
            $("#sync-indicator").show();
            
            const questionsRef = database.ref('questions');
            questionsRef.remove()
                .then(() => {
                    questions = [];
                    updateQuestionsCount();
                    $("#sync-indicator").hide();
                    showSuccess("Все вопросы удалены!");
                })
                .catch((error) => {
                    console.error('Ошибка при удалении вопросов:', error);
                    $("#sync-indicator").hide();
                    showError("Ошибка при удалении вопросов. Проверьте правила доступа Firebase.");
                });
        }
        
        // Функция для отправки вопроса
        $("#submit-question").click(function() {
            const guestId = $("#guest-select").val();
            const anonymous = $("#anonymous").is(":checked");
            const questionText = $("#question-text").val().trim();
            
            // Проверяем валидность данных
            if (!guestId && !anonymous) {
                showError("Пожалуйста, выберите гостя или отметьте анонимность");
                return;
            }
            
            if (!questionText) {
                showError("Пожалуйста, введите вопрос");
                return;
            }
            
            if (!questionText.toLowerCase().includes("кто")) {
                if (!confirm("Ваш вопрос не содержит слово 'кто'. Вы уверены, что хотите отправить его?")) {
                    return;
                }
            }
            
            $("#spinner").show();
            
            // Создаем объект вопроса
            const newQuestion = {
                id: Date.now(),
                guestId: guestId,
                anonymous: anonymous,
                question: questionText,
                timestamp: new Date().toISOString(),
                answered: false
            };
            
            // Сохраняем вопрос в Firebase
            saveQuestion(newQuestion)
                .then((success) => {
                    if (success) {
                        // Очищаем форму
                        $("#guest-select").val("");
                        $("#anonymous").prop("checked", false);
                        $("#question-text").val("");
                        
                        showSuccess("Ваш вопрос добавлен в общий список!");
                    }
                    $("#spinner").hide();
                });
        });
        
        // Функция для обновления счетчика вопросов
        function updateQuestionsCount() {
            const questionsCount = $("#questions-count");
            const statusMessage = $("#status-message");
            const startPresentationBtn = $("#start-presentation");
            
            questionsCount.text(questions.length);
            
            if (questions.length === 0) {
                statusMessage.removeClass("status-ready").addClass("status-waiting")
                    .text("Ожидаем вопросы от гостей...");
                startPresentationBtn.prop("disabled", true);
            } else {
                statusMessage.removeClass("status-waiting").addClass("status-ready")
                    .text("Вопросы получены! Можно начинать показ.");
                startPresentationBtn.prop("disabled", false);
            }
        }
        
        // Показ сообщения об ошибке
        function showError(message) {
            $("#error-message").text(message).show();
            $("#success-message").hide();
            setTimeout(() => $("#error-message").fadeOut(), 5000);
        }
        
        // Показ сообщения об успехе
        function showSuccess(message) {
            $("#success-message").text(message).show();
            $("#error-message").hide();
            setTimeout(() => $("#success-message").fadeOut(), 3000);
        }
        
        // Обработчик кнопки "Начать показ вопросов"
        $("#start-presentation").click(function() {
            if (questions.length === 0) {
                showError("Нет вопросов для показа!");
                return;
            }
            
            currentPresentationIndex = 0;
            showPresentationQuestion(questions[currentPresentationIndex]);
            
            $("#main-screen").hide();
            $("#question-presentation").show();
        });
        
        // Функция для отображения вопроса в режиме презентации
        function showPresentationQuestion(question) {
            $("#presentation-question").text(question.question);
            
            let authorText = "Анонимный гость";
            let photoSrc = "anonymous.jpg"; // Заглушка для анонимных вопросов
            
            if (!question.anonymous && question.guestId !== null) {
                authorText = guestNames[question.guestId] + " - " + guestStatuses[question.guestId];
                // Формируем путь к фото: 1 (2).jpg, 1 (3).jpg и т.д.
                // Индекс + 2, так как первый гость (невеста) имеет индекс 0, но фото начинаются с 1 (2).jpg
                photoSrc = "1 (" + (parseInt(question.guestId) + 2) + ").jpg";
            }
            
            $("#presentation-author").text("Вопрос от: " + authorText);
            $("#guest-photo").attr("src", photoSrc).attr("alt", authorText);
        }
        
        // Обработчик кнопки "Следующий вопрос" в режиме презентации
        $("#next-presentation").click(function() {
            currentPresentationIndex++;
            
            if (currentPresentationIndex < questions.length) {
                showPresentationQuestion(questions[currentPresentationIndex]);
            } else {
                $("#question-presentation").hide();
                $("#main-screen").show();
                showSuccess("Все вопросы показаны!");
            }
        });
        
        // Обработчик кнопки "Завершить показ"
        $("#end-presentation").click(function() {
            $("#question-presentation").hide();
            $("#main-screen").show();
            currentPresentationIndex = -1;
        });
        
        // Обработчик кнопки "Начать отвечать на вопросы"
        $("#start-answers").click(function() {
            if (questions.length === 0) {
                showError("Нет вопросов для ответа!");
                return;
            }
            
            currentQuestionIndex = 0;
            showQuestion(questions[currentQuestionIndex]);
            
            $("#main-screen").hide();
            $("#question-container").show();
            $("#answer-section").show();
        });
        
        // Функция для отображения текущего вопроса
        function showQuestion(question) {
            currentQuestion = question;
            groomAnswer = null;
            brideAnswer = null;
            
            $("#current-question").text(question.question);
            $("#result-question").text(question.question);
            
            let authorText = "Анонимный гость";
            if (!question.anonymous && question.guestId !== null) {
                authorText = guestNames[question.guestId] + " - " + guestStatuses[question.guestId];
            }
            
            $("#question-author").text("Вопрос от: " + authorText);
            $("#result-author").text("Вопрос от: " + authorText);
            
            $(".answer-option").removeClass("selected");
            $("#submit-groom, #submit-bride").prop("disabled", false);
        }
        
        // Обработчики выбора ответов
        $(".answer-option").click(function() {
            $(this).siblings().removeClass("selected");
            $(this).addClass("selected");
        });
        
        $("#submit-groom").click(function() {
            const selected = $(this).siblings(".answer-options").find(".selected");
            if (selected.length === 0) {
                showError("Пожалуйста, выберите ответ");
                return;
            }
            
            groomAnswer = selected.data("answer");
            $(this).prop("disabled", true);
            checkAnswers();
        });
        
        $("#submit-bride").click(function() {
            const selected = $(this).siblings(".answer-options").find(".selected");
            if (selected.length === 0) {
                showError("Пожалуйста, выберите ответ");
                return;
            }
            
            brideAnswer = selected.data("answer");
            $(this).prop("disabled", true);
            checkAnswers();
        });
        
        // Функция для проверки, ответили ли оба
        function checkAnswers() {
            if (groomAnswer && brideAnswer) {
                showResults();
            }
        }
        
        // Функция для показа результатов
        function showResults() {
            $("#groom-answer").text(groomAnswer === "he" ? "ОН" : "ОНА");
            $("#bride-answer").text(brideAnswer === "he" ? "ОН" : "ОНА");
            
            const resultText = groomAnswer === brideAnswer ? "Совпадение! 🎉" : "Разные ответы! 😄";
            $("#result-text").text(resultText);
            
            // Помечаем вопрос как отвеченный в базе данных
            markQuestionAsAnswered(currentQuestionIndex);
            
            $("#question-container").hide();
            $("#results-container").show();
            createConfetti();
        }
        
        // Пометить вопрос как отвеченный
        function markQuestionAsAnswered(index) {
            if (!navigator.onLine) return;
            
            if (questions[index] && questions[index].id) {
                const questionId = questions[index].id;
                const questionRef = database.ref('questions').orderByChild('id').equalTo(questionId);
                
                questionRef.once('value')
                    .then((snapshot) => {
                        snapshot.forEach((childSnapshot) => {
                            childSnapshot.ref.update({ answered: true });
                        });
                    });
            }
        }
        
        // Обработчик для кнопки "Следующий вопрос"
        $("#next-question").click(function() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                showQuestion(questions[currentQuestionIndex]);
                $("#results-container").hide();
                $("#question-container").show();
            } else {
                $("#results-container").hide();
                $("#main-screen").show();
                showSuccess("Вопросы закончились! Спасибо за участие в игре!");
            }
        });
        
        // Обработчик для кнопки "Завершить ответы"
        $("#finish-answers").click(function() {
            $("#results-container").hide();
            $("#main-screen").show();
            currentQuestionIndex = -1;
            updateQuestionsCount();
        });
        
        // Функция для создания конфетти
        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            const container = $('.container');
            
            for (let i = 0; i < 20; i++) {
                const confetti = $('<div class="confetti"></div>');
                confetti.css({
                    left: Math.random() * 100 + '%',
                    background: colors[Math.floor(Math.random() * colors.length)],
                    transform: 'rotate(' + (Math.random() * 360) + 'deg)'
                });
                
                container.append(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }
        }
        
        // Мониторинг соединения с Firebase
        const connectedRef = database.ref(".info/connected");
        connectedRef.on("value", (snap) => {
            if (snap.val() === true) {
                $("#connection-status").removeClass("disconnected").addClass("connected").text("✓ Подключено");
                $("#offline-message").hide();
            } else {
                $("#connection-status").removeClass("connected").addClass("disconnected").text("✗ Offline");
                $("#offline-message").show();
            }
        });
    </script>
</body>
</html>
